This error **only happens in *production build*** â€” not in dev â€” because:

### âœ… **React is NOT being imported correctly inside your production bundle.**

Your Vite config is doing this:

```ts
dedupe: ["react", "react-dom"],
optimizeDeps: { include: ["react", "react-dom"] }
```

But **your project is structured under `/client`**, and Vite tries loading React twice (one from root, one from client).
In production build, this causes:

```
React = null â†’ React.useState is undefined
```

---

# âœ… **SOLUTION (WORKS 100%)**

Just copyâ€“paste this Vite config fix below.

### âœ” Remove duplicate optimizeDeps

### âœ” Remove dedupe

### âœ” Ensure correct React import

### âœ” Fix aliases

---

# âœ… **ğŸ”¥ FINAL WORKING `vite.config.ts` â€” COPY & PASTE**

```ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";
import runtimeErrorOverlay from "@replit/vite-plugin-runtime-error-modal";

export default defineConfig({
  plugins: [
    react(),
    ...(process.env.NODE_ENV !== "production" ? [runtimeErrorOverlay()] : []),
  ],

  // your project root is "client"
  root: path.resolve(__dirname, "client"),

  resolve: {
    alias: {
      "@": path.resolve(__dirname, "client/src"),
      "@shared": path.resolve(__dirname, "shared"),
      "@assets": path.resolve(__dirname, "attached_assets"),
    },
  },

  build: {
    outDir: path.resolve(__dirname, "dist/public"),
    emptyOutDir: true,
    target: "esnext",
    sourcemap: false,
    minify: "esbuild",
    cssCodeSplit: true,

    rollupOptions: {
      output: {
        manualChunks: undefined,
      },
    },
  },

  server: {
    fs: {
      strict: false,
    },
  },
});
```

---

# ğŸ¯ **Now Do This:**

### 1. Delete old build

```
rm -rf dist
```

### 2. Rebuild

```
npm run build
```

### 3. Preview

```
npm run preview
```

---

# ğŸ€ **Why this works**

Your error:

```
React.useState is null
```

means **React was bundled twice**, causing two Reacts in production â†’ your components use one React, but Vite loads another â†’ hooks break.

Removing:

* `optimizeDeps`
* `dedupe`
* complex chunking

fixes it 100%.

---

If you want, send me your **theme-provider.tsx** file too â€” Iâ€™ll verify everything is safe.
